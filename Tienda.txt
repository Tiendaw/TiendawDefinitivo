---"DEFINITIVAS"
DROP TABLE PERSONAS;
DROP TABLE CLIENTES;
DROP TABLE EMPLEADOS;

DROP TABLE PROVEEDORES;
DROP TABLE PEDIDOS;
DROP TABLE PRECIOS;

DROP TABLE ALMACENES;
DROP TABLE GESTIONA;
DROP TABLE PRODUCTOS;

DROP TABLE ENCARGADOS;


CREATE TABLE PERSONAS(
TIPO VARCHAR2 (1) NOT NULL  CHECK (TIPO IN ('E','C','P')),
DNI VARCHAR2(9) PRIMARY KEY,
NOMBRE VARCHAR2(20),
APELLIDO VARCHAR2(20),
TELEFONO NUMBER(9),
DIRECCION VARCHAR2(25),
COD_POSTAL NUMBER(5),
CONTRASEÑA VARCHAR2(20),
CORREO_ELECTRONICO VARCHAR2(30)
);

CREATE TABLE CLIENTES(
DNI VARCHAR2(9) REFERENCES PERSONAS(DNI) ON DELETE CASCADE,
NOM_USUARIO VARCHAR2(15) UNIQUE,
CONTRASEÑA VARCHAR2(20),
CONSTRAINT PK_CLIENTES PRIMARY KEY(DNI)
);



CREATE TABLE EMPLEADOS(
DNI VARCHAR2(9) REFERENCES PERSONAS(DNI) ON DELETE CASCADE,
SALARIO NUMBER(7,2),
ENCARGADO NUMBER(4),
CONSTRAINT PK_EMPLEADOS PRIMARY KEY(DNI)
);



CREATE TABLE ALMACENES(
COD_ALMACEN NUMBER(4),
CAP_MAXIMA NUMBER(4),
DNI VARCHAR2(9) NOT NULL,
CONSTRAINT PK_ALMACENES PRIMARY KEY(COD_ALMACEN),
CONSTRAINT FK_ALMACENES_EMPLEADOS FOREIGN KEY(DNI) 
REFERENCES EMPLEADOS(DNI) ON DELETE CASCADE
);

CREATE TABLE ENCARGADOS(
COD_ENCARGADO NUMBER(4),
DNI_EMPLEADOS VARCHAR2(9),
CONTRASEÑA VARCHAR2(30) ,
CONSTRAINT PK_ENCARGADOS PRIMARY KEY(COD_ENCARGADO, DNI_EMPLEADOS),
CONSTRAINT FK_ENCARGADOS FOREIGN KEY(DNI_EMPLEADOS) REFERENCES EMPLEADOS(DNI) ON DELETE CASCADE
);


CREATE TABLE PROVEEDORES(
COD_PROV NUMBER(4),
DNI VARCHAR2(9) REFERENCES PERSONAS(DNI) ON DELETE CASCADE,
COD_ALMACEN NUMBER(4) REFERENCES ALMACENES(COD_ALMACEN),
CONSTRAINT PK_PROVEEDORES PRIMARY KEY(DNI, COD_PROV),
CONSTRAINT FK_PROVEEDORES FOREIGN KEY(DNI) REFERENCES PERSONAS(DNI) ON DELETE CASCADE
);



CREATE TABLE PRODUCTOS(
COD_ALMACEN NUMBER(4) DEFAULT 1,
TALLA NUMBER(2),
COD_PRODUCTO NUMBER(4),
CANTIDAD NUMBER(3),
COLOR VARCHAR2(20),
DESCRIPCION VARCHAR2(150),
MARCA VARCHAR2(20),
COD_PRECIO NUMBER(4)NOT NULL CONSTRAINT CK_PRECIO CHECK (COD_PRECIO > 0),
CONSTRAINT PK_PRODUCTOS PRIMARY KEY(COD_ALMACEN, COD_PRODUCTO)
);



CREATE TABLE PRECIOS(
COD_PRECIO NUMBER(4) PRIMARY KEY,
PRECIO NUMBER(6,2)
);



CREATE TABLE PEDIDOS(
COD_PEDIDO NUMBER(4) PRIMARY KEY,
CLIENTE VARCHAR2(9) REFERENCES CLIENTES(DNI),
FECHA_PEDIDO DATE DEFAULT SYSDATE,
FECHA_ENTREGA DATE,
IMPORTE NUMBER(8,2),
PRODUCTOS VARCHAR2(500) NOT NULL 
);



CREATE TABLE GESTIONA(
DNI VARCHAR2(9),
COD_PEDIDO NUMBER(4),

CONSTRAINT PK_GESTIONA PRIMARY KEY(DNI, COD_PEDIDO),
CONSTRAINT FK_GESTIONA_DNI FOREIGN KEY(DNI) REFERENCES EMPLEADOS(DNI) ON DELETE CASCADE,
 CONSTRAINT FK_GESTIONA_COD_PEDIDO FOREIGN KEY(COD_PEDIDO) REFERENCES PEDIDOS(COD_PEDIDO) ON DELETE CASCADE
);








--INSERTS


INSERT INTO PERSONAS VALUES('12345678A','JORGE','CAMACHO',666666666,'C/ LIMA',28041,'JORGECAMACHO@GMAIL.COM');
INSERT INTO PERSONAS VALUES('11111111B','JOEL ALEXIS','NARV?EZ',111111111,'C/ LIM?N',28021,'JOELALEXISNARVAEZ@GMAIL.COM');
INSERT INTO PERSONAS VALUES('22222222C','ISMAEL','PATROCINIO',222222222,'C/ PERA',28014,'ISMAELPATROCINIO@GMAIL.COM');
SELECT * FROM PERSONAS;
